# Frontend Documentation

This directory contains comprehensive documentation for the React frontend of the Moonshine Coffee Management Sim.

## Overview

The frontend is built with **React 19**, **TypeScript**, **Inertia.js 2.0**, and **TailwindCSS 4.0**, providing a modern SPA experience with server-side rendering support. The architecture emphasizes type safety, component reusability, and excellent developer experience.

## Tech Stack

- **Framework**: React 19
- **Language**: TypeScript 5.x (strict mode)
- **UI Library**: Radix UI (accessible components)
- **Styling**: TailwindCSS 4.0
- **Icons**: Lucide React
- **Bridge**: Inertia.js 2.0
- **Routing**: Laravel Wayfinder (TypeScript route helper)
- **Build Tool**: Vite 5.x
- **SSR**: Inertia SSR support

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│                     React Application                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Pages      │  │  Components  │  │   Layouts    │  │
│  │  (Inertia)   │  │   (Reusable) │  │ (App/Auth)   │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│         │                  │                  │         │
│         └──────────────────┴──────────────────┘         │
│                        │                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Contexts   │  │    Hooks     │  │   Services   │  │
│  │ (Game State) │  │  (Custom)    │  │  (Business)  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │         Types & Constants (TypeScript)           │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
└─────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────┐
│                     Inertia.js Bridge                    │
└─────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────┐
│                  Laravel Backend (API)                   │
└─────────────────────────────────────────────────────────┘
```

## Directory Structure

```
resources/js/
├── actions/              # Server action types (auto-generated by Wayfinder)
├── app.tsx              # Main application entry point
├── assets/              # Static assets (icons, images)
│   └── icons.tsx        # SVG icon components
├── components/          # Reusable UI components
│   ├── game/            # Game-specific components
│   │   ├── advance-day-button.tsx
│   │   ├── cancel-order-dialog.tsx
│   │   ├── cash-display.tsx
│   │   ├── day-counter.tsx
│   │   └── route-capacity-meter.tsx
│   ├── ui/              # Base UI components (Radix-based)
│   │   ├── alert.tsx
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── dialog.tsx
│   │   ├── input.tsx
│   │   ├── select.tsx
│   │   ├── table.tsx
│   │   └── ... (30+ components)
│   ├── Analytics.tsx
│   ├── Dashboard.tsx
│   ├── EmergencyActionModal.tsx
│   ├── Inventory.tsx
│   ├── Ordering.tsx
│   ├── PolicyDeck.tsx
│   ├── SpikeHistory.tsx
│   ├── SpikeMonitor.tsx
│   └── Transfers.tsx
├── constants.ts         # Game constants (items, locations, vendors)
├── contexts/            # React contexts
│   └── game-context.tsx # Game state context provider
├── hooks/               # Custom React hooks
│   ├── use-active-url.ts
│   ├── use-appearance.tsx
│   ├── use-clipboard.ts
│   ├── use-initials.tsx
│   ├── use-mobile.tsx
│   ├── use-mobile-navigation.ts
│   └── use-two-factor-auth.ts
├── layouts/             # Page layouts
│   ├── app/             # Authenticated app layouts
│   │   ├── app-header-layout.tsx
│   │   └── app-sidebar-layout.tsx
│   ├── auth/            # Authentication layouts
│   │   ├── auth-card-layout.tsx
│   │   ├── auth-simple-layout.tsx
│   │   └── auth-split-layout.tsx
│   ├── app-layout.tsx
│   ├── auth-layout.tsx
│   └── settings/        # Settings page layout
│       └── layout.tsx
├── lib/                 # Utilities
│   └── utils.ts         # Helper functions (cn, formatters)
├── pages/               # Inertia pages
│   ├── auth/            # Authentication pages
│   │   ├── confirm-password.tsx
│   │   ├── forgot-password.tsx
│   │   ├── login.tsx
│   │   ├── register.tsx
│   │   ├── reset-password.tsx
│   │   ├── two-factor-challenge.tsx
│   │   └── verify-email.tsx
│   ├── game/            # Game pages
│   │   ├── analytics.tsx
│   │   ├── inventory.tsx
│   │   ├── reports.tsx
│   │   ├── sku-detail.tsx
│   │   ├── spike-history.tsx
│   │   ├── strategy.tsx
│   │   ├── vendors.tsx
│   │   ├── vendors/detail.tsx
│   │   └── welcome.tsx
│   └── settings/        # Settings pages
│       ├── appearance.tsx
│       ├── password.tsx
│       ├── profile.tsx
│       └── two-factor.tsx
├── routes/              # Wayfinder route definitions
│   ├── game/            # Game routes
│   │   ├── alerts/
│   │   ├── logistics/
│   │   ├── orders/
│   │   ├── policy/
│   │   └── transfers/
│   └── index.ts         # Route aggregation
├── services/            # Frontend business logic
│   ├── cockpitService.ts      # Dashboard KPIs and alerts
│   ├── geminiService.ts       # AI service integration
│   ├── inventoryService.ts    # Inventory calculations
│   ├── orderCalculations.ts   # Order cost calculations
│   ├── policyService.ts       # Policy impact analysis
│   ├── skuMath.ts             # SKU-level math (ROP, safety stock)
│   ├── spikeService.ts        # Spike detection and handling
│   ├── transferService.ts     # Transfer suggestions
│   ├── vendorService.ts       # Vendor scoring
│   └── wasteService.ts        # Waste tracking
├── ssr.tsx              # SSR entry point
├── types/               # TypeScript type definitions
│   ├── game.ts          # Game domain types
│   ├── index.d.ts       # Global type augmentations
│   ├── index.ts         # Re-exports
│   └── vite-env.d.ts    # Vite environment types
└── wayfinder/           # Wayfinder integration
    └── index.ts
```

## Documentation Files

1. **[Architecture](./01-architecture.md)** - Frontend architecture and design patterns
2. **[Components](./02-components.md)** - Component library and usage
3. **[Pages & Routes](./03-pages-routes.md)** - Inertia pages and routing
4. **[State Management](./04-state-management.md)** - Context, hooks, and data flow
5. **[Services](./05-services.md)** - Frontend business logic services
6. **[Styling](./06-styling.md)** - TailwindCSS patterns and design system
7. **[TypeScript](./07-typescript.md)** - Type system and best practices

## Key Concepts

### Inertia.js Integration

Inertia bridges Laravel and React, enabling:
- Server-side rendering
- Automatic CSRF protection
- Type-safe props
- Simple routing without API layer
- Progressive enhancement

**Page Component Example**:
```tsx
import { Head } from '@inertiajs/react';

interface Props {
  gameState: GameState;
  locations: Location[];
}

export default function Inventory({ gameState, locations }: Props) {
  return (
    <>
      <Head title="Inventory" />
      <div>
        {/* Component content */}
      </div>
    </>
  );
}
```

### TypeScript Strict Mode

The application uses TypeScript in **strict mode** for maximum type safety:
- All props must be typed
- No implicit `any`
- Null checks enforced
- Strict function types

**Benefits**:
- Catch errors at compile time
- Better IDE support
- Self-documenting code
- Easier refactoring

### Component Architecture

**Principles**:
1. **Composition over inheritance**
2. **Single responsibility**
3. **Prop drilling minimization** (use context for deep props)
4. **Type-safe props** (no prop spreading without types)

**Component Categories**:
- **UI Components** (`components/ui/`) - Generic, reusable
- **Game Components** (`components/game/`) - Game-specific
- **Feature Components** (`components/*.tsx`) - Composite features
- **Page Components** (`pages/`) - Inertia entry points
- **Layout Components** (`layouts/`) - Page structure

### Service Layer

Business logic is extracted into service modules:
- **Pure functions** (no side effects)
- **Testable** in isolation
- **Reusable** across components
- **Type-safe** inputs and outputs

**Example**:
```typescript
// services/skuMath.ts
export function calculateReorderPoint(
  avgDailyUsage: number,
  leadTimeDays: number,
  serviceLevel: number
): number {
  const zScore = getZScore(serviceLevel);
  const safetyStock = zScore * Math.sqrt(leadTimeDays) * (avgDailyUsage * 0.2);
  return (avgDailyUsage * leadTimeDays) + safetyStock;
}
```

### Context for Global State

Game state is managed via React Context:

```tsx
// contexts/game-context.tsx
export const GameContext = createContext<GameContextType | null>(null);

export function useGame() {
  const context = useContext(GameContext);
  if (!context) throw new Error('useGame must be used within GameProvider');
  return context;
}
```

Components access game state via `useGame()` hook.

## Development Workflow

### Running Development Server

```bash
# Frontend only
npm run dev

# Full stack with SSR
composer dev:ssr
```

### Building for Production

```bash
# Build frontend assets
npm run build

# Build SSR bundle
npm run build:ssr
```

### Linting & Formatting

```bash
# Lint TypeScript
npm run lint

# Format with Prettier
npm run format

# Check formatting
npm run format:check

# Type check
npm run types
```

## Component Patterns

### Form Handling with Inertia

```tsx
import { useForm } from '@inertiajs/react';

function OrderForm() {
  const { data, setData, post, processing, errors } = useForm({
    location_id: '',
    items: []
  });

  const handleSubmit = (e: FormEvent) => {
    e.preventDefault();
    post(route('game.orders.store'));
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* Form fields */}
      <button type="submit" disabled={processing}>
        Place Order
      </button>
      {errors.location_id && <span>{errors.location_id}</span>}
    </form>
  );
}
```

### Data Fetching

Inertia automatically fetches data on navigation. For partial reloads:

```tsx
import { router } from '@inertiajs/react';

// Partial reload (only specific props)
router.reload({ only: ['orders', 'gameState'] });

// Visit with preserved state
router.visit(route('game.inventory'), {
  preserveState: true,
  preserveScroll: true
});
```

### Conditional Rendering

```tsx
{gameState.cash < 100 && (
  <Alert variant="destructive">
    <AlertTitle>Low Cash Warning</AlertTitle>
    <AlertDescription>
      You have less than $100 remaining.
    </AlertDescription>
  </Alert>
)}
```

## Styling Patterns

### TailwindCSS Utilities

```tsx
<div className="flex items-center justify-between rounded-lg border p-4 shadow-sm">
  <h3 className="text-lg font-semibold">Inventory</h3>
  <Badge variant="success">Healthy</Badge>
</div>
```

### Responsive Design

```tsx
<div className="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
  {items.map(item => <ItemCard key={item.id} item={item} />)}
</div>
```

### Dark Mode Support

```tsx
<div className="bg-white dark:bg-gray-900 text-black dark:text-white">
  {/* Content */}
</div>
```

## Testing Strategy

### Component Testing

```tsx
import { render, screen } from '@testing-library/react';
import { CashDisplay } from '@/components/game/cash-display';

test('displays cash amount correctly', () => {
  render(<CashDisplay cash={1234.56} />);
  expect(screen.getByText('$1,234.56')).toBeInTheDocument();
});
```

### Integration Testing

Test components with context:

```tsx
import { GameProvider } from '@/contexts/game-context';

test('inventory updates after order delivery', () => {
  render(
    <GameProvider initialState={mockGameState}>
      <Inventory />
    </GameProvider>
  );

  // Test logic
});
```

## Performance Optimization

### Code Splitting

Vite automatically splits code by route. Manual splits for heavy components:

```tsx
import { lazy, Suspense } from 'react';

const Analytics = lazy(() => import('@/components/Analytics'));

function Dashboard() {
  return (
    <Suspense fallback={<Spinner />}>
      <Analytics />
    </Suspense>
  );
}
```

### Memoization

```tsx
import { useMemo } from 'react';

function InventoryList({ items, filters }) {
  const filteredItems = useMemo(
    () => items.filter(item => matchesFilters(item, filters)),
    [items, filters]
  );

  return <>{/* Render filteredItems */}</>;
}
```

### React.memo for Expensive Components

```tsx
import { memo } from 'react';

export const ExpensiveChart = memo(function ExpensiveChart({ data }) {
  // Complex rendering logic
  return <Chart data={data} />;
});
```

## Accessibility

All UI components use Radix UI primitives which provide:
- Keyboard navigation
- ARIA attributes
- Focus management
- Screen reader support

## Browser Support

- **Modern browsers**: Chrome, Firefox, Safari, Edge (latest 2 versions)
- **No IE11 support** (ES2020+ features used)

## Related Documentation

- [Backend Documentation](../backend/)
- [Domain Documentation](../domain/)
- [CLAUDE.md](../../CLAUDE.md) - AI agent instructions
